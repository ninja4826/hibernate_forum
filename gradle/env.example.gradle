import groovy.json.JsonOutput

ext {
    jdbcDriver = 'driver'
    jdbcUser = 'user'
    jdbcPassword = 'pass'
    jdbcURL = 'jdbc://localhost/db_name'
    jdbcDatabaseName = 'db_name'
    jwtSecret = 'base64_encoded_secret'
    jwtDecoded = 'secret'
    webHost = 'www.example.com'
    webAddress = 'www.example.com'
    webPort = '8080'

    hbDialect = "org.hibernate.dialect.PostgreSQLDialect"
    hbShowSQL = "true"
    hbFormatSQL = "true"
    hbSessionContextClass = "thread"
}

task prep << {
    project.ext.set("jdbcDriver", jdbcDriver)
    project.ext.set("jdbcUser", jdbcUser)
    project.ext.set("jdbcPassword", jdbcPassword)
    project.ext.set("jdbcURL", jdbcURL)
    project.ext.set("jdbcDatabaseName", jdbcDatabaseName)
    project.ext.set("jwtSecret", jwtSecret)
    project.ext.set("webHost", webHost)
    project.ext.set("webAddress", webAddress)
    project.ext.set("webPort", webPort)
}

task prepHibernate(dependsOn: prep) {
    def hbObj = [
        properties: [
            "hibernate.connection.driver_class": jdbcDriver,
            "hibernate.connection.url": jdbcURL,
            "hibernate.connection.username": jdbcUser,
            "hibernate.connection.password": jdbcPassword,
            "hibernate.dialect": hbDialect,
            "show_sql": hbShowSQL,
            "format_sql": hbFormatSQL,
            "hibernate.current_session_context_class": hbSessionContextClass
        ],
        mappings: [
            "me.ninja4826.forum.gen.Category",
            "me.ninja4826.forum.gen.Topic",
            "me.ninja4826.forum.gen.Post",
            "me.ninja4826.forum.gen.CategoryAncestor",
            "me.ninja4826.forum.gen.PostAncestor",
            "me.ninja4826.forum.gen.User"
        ]
    ]
    project.ext.set("hbConfig", JsonOutput.toJson(hbObj))
}
